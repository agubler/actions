(function (factory) {
    if (typeof module === 'object' && typeof module.exports === 'object') {
        var v = factory(require, exports); if (v !== undefined) module.exports = v;
    }
    else if (typeof define === 'function' && define.amd) {
        define(["require", "exports", './global'], factory);
    }
})(function (require, exports) {
    "use strict";
    var global_1 = require('./global');
    exports.cache = Object.create(null);
    exports.testFunctions = Object.create(null);
    /**
     * Conditional loading of AMD modules based on a has feature test value.
     *
     * @param resourceId Gives the resolved module id to load.
     * @param require The loader require function with respect to the module that contained the plugin resource in it's dependency list.
     * @param load Callback to loader that consumes result of plugin demand.
     */
    function load(resourceId, require, load, config) {
        if (resourceId) {
            require([resourceId], load);
        }
        else {
            load();
        }
    }
    exports.load = load;
    /**
     * Resolves resourceId into a module id based on possibly-nested tenary expression that branches on has feature test value(s).
     *
     * @param resourceId The id of the module
     * @param normalize Resolves a relative module id into an absolute module id
     */
    function normalize(resourceId, normalize) {
        var tokens = resourceId.match(/[\?:]|[^:\?]*/g);
        var i = 0;
        function get(skip) {
            var term = tokens[i++];
            if (term === ':') {
                // empty string module name, resolves to null
                return null;
            }
            else {
                // postfixed with a ? means it is a feature to branch on, the term is the name of the feature
                if (tokens[i++] === '?') {
                    if (!skip && has(term)) {
                        // matched the feature, get the first value from the options
                        return get();
                    }
                    else {
                        // did not match, get the second value, passing over the first
                        get(true);
                        return get(skip);
                    }
                }
                // a module
                return term;
            }
        }
        resourceId = get();
        return resourceId && normalize(resourceId);
    }
    exports.normalize = normalize;
    /**
     * Check if a feature has already been registered
     *
     * @param feature the name of the feature
     * @return if the feature has been registered
     */
    function exists(feature) {
        return feature in exports.cache || feature in exports.testFunctions;
    }
    exports.exists = exists;
    /**
     * Register a new test for a named feature.
     *
     * @example
     * has.add('dom-addeventlistener', !!document.addEventListener);
     *
     * @example
     * has.add('touch-events', function () {
     *    return 'ontouchstart' in document
     * });
     *
     * @param feature the name of the feature
     * @param value the value reported of the feature, or a function that will be executed once on first test
     * @param overwrite if an existing value should be overwritten. Defaults to false.
     * @return if the feature test was successfully added
     */
    function add(feature, value, overwrite) {
        if (overwrite === void 0) { overwrite = false; }
        if (exists(feature) && !overwrite) {
            return false;
        }
        if (typeof value === 'function') {
            exports.testFunctions[feature] = value;
        }
        else {
            exports.cache[feature] = value;
            // Ensure we don't have stale tests sitting around that could overwrite a cache value being set
            delete exports.testFunctions[feature];
        }
        return true;
    }
    exports.add = add;
    /**
     * Return the current value of a named feature.
     *
     * @param feature The name (if a string) or identifier (if an integer) of the feature to test.
     * @return The value of a given feature test
     */
    function has(feature) {
        var result;
        if (exports.testFunctions[feature]) {
            result = exports.cache[feature] = exports.testFunctions[feature].call(null);
            exports.testFunctions[feature] = null;
        }
        else {
            result = exports.cache[feature];
        }
        return result;
    }
    Object.defineProperty(exports, "__esModule", { value: true });
    exports.default = has;
    /*
     * OOTB feature tests
     */
    add('host-browser', typeof document !== 'undefined' && typeof location !== 'undefined');
    add('host-node', function () {
        if (typeof process === 'object' && process.versions && process.versions.node) {
            return process.versions.node;
        }
    });
    add('float32array', 'Float32Array' in global_1.default);
    add('setimmediate', typeof global_1.default.setImmediate !== 'undefined');
    add('dom-mutationobserver', function () {
        return has('host-browser') && Boolean(global_1.default.MutationObserver || global_1.default.WebKitMutationObserver);
    });
    add('microtasks', function () {
        return has('promise') || has('host-node') || has('dom-mutationobserver');
    });
    add('object-assign', typeof Object.assign === 'function');
    add('object-observe', typeof Object.observe === 'function');
    add('postmessage', typeof postMessage === 'function');
    add('promise', typeof global_1.default.Promise !== 'undefined');
    add('raf', typeof requestAnimationFrame === 'function');
    add('weakmap', function () {
        if (typeof global_1.default.WeakMap !== 'undefined') {
            var key1 = {};
            var key2 = {};
            var map = new global_1.default.WeakMap([[key1, 1]]);
            return map.get(key1) === 1 && map.set(key2, 2) === map;
        }
        return false;
    });
    add('arraybuffer', typeof global_1.default.ArrayBuffer !== 'undefined');
    add('formdata', typeof global_1.default.FormData !== 'undefined');
    add('xhr', typeof global_1.default.XMLHttpRequest !== 'undefined');
    add('xhr2', has('xhr') && 'responseType' in global_1.default.XMLHttpRequest.prototype);
    add('xhr2-blob', function () {
        if (!has('xhr2')) {
            return false;
        }
        var request = new XMLHttpRequest();
        request.open('GET', '/', true);
        request.responseType = 'blob';
        request.abort();
        return request.responseType === 'blob';
    });
    add('es6-symbol', typeof global_1.default.Symbol === 'function');
    add('es6-set', function () {
        if (typeof global_1.default.Set === 'function') {
            /* IE11 and older versions of Safari are missing critical ES6 Set functionality */
            var set = new global_1.default.Set([1]);
            return set.has(1) && 'keys' in set && typeof set.keys === 'function';
        }
        return false;
    });
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaGFzLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vc3JjL2hhcy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7SUFBQSx1QkFBbUIsVUFBVSxDQUFDLENBQUE7SUFNakIsYUFBSyxHQUFxQixNQUFNLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxDQUFDO0lBQzlDLHFCQUFhLEdBQXFCLE1BQU0sQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLENBQUM7SUFFbkU7Ozs7OztPQU1HO0lBQ0gsY0FBcUIsVUFBa0IsRUFBRSxPQUEyQixFQUFFLElBQTJCLEVBQUUsTUFBMEI7UUFDNUgsRUFBRSxDQUFDLENBQUMsVUFBVSxDQUFDLENBQUMsQ0FBQztZQUNoQixPQUFPLENBQUMsQ0FBRSxVQUFVLENBQUUsRUFBRSxJQUFJLENBQUMsQ0FBQztRQUMvQixDQUFDO1FBQ0QsSUFBSSxDQUFDLENBQUM7WUFDTCxJQUFJLEVBQUUsQ0FBQztRQUNSLENBQUM7SUFDRixDQUFDO0lBUGUsWUFBSSxPQU9uQixDQUFBO0lBRUQ7Ozs7O09BS0c7SUFDSCxtQkFBMEIsVUFBa0IsRUFBRSxTQUF1QztRQUNwRixJQUFNLE1BQU0sR0FBRyxVQUFVLENBQUMsS0FBSyxDQUFDLGdCQUFnQixDQUFDLENBQUM7UUFDbEQsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDO1FBRVYsYUFBYSxJQUFjO1lBQzFCLElBQU0sSUFBSSxHQUFHLE1BQU0sQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDO1lBQ3pCLEVBQUUsQ0FBQyxDQUFDLElBQUksS0FBSyxHQUFHLENBQUMsQ0FBQyxDQUFDO2dCQUNsQiw2Q0FBNkM7Z0JBQzdDLE1BQU0sQ0FBQyxJQUFJLENBQUM7WUFDYixDQUFDO1lBQ0QsSUFBSSxDQUFDLENBQUM7Z0JBQ0wsNkZBQTZGO2dCQUM3RixFQUFFLENBQUMsQ0FBQyxNQUFNLENBQUMsQ0FBQyxFQUFFLENBQUMsS0FBSyxHQUFHLENBQUMsQ0FBQyxDQUFDO29CQUN6QixFQUFFLENBQUMsQ0FBQyxDQUFDLElBQUksSUFBSSxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDO3dCQUN4Qiw0REFBNEQ7d0JBQzVELE1BQU0sQ0FBQyxHQUFHLEVBQUUsQ0FBQztvQkFDZCxDQUFDO29CQUNELElBQUksQ0FBQyxDQUFDO3dCQUNMLDhEQUE4RDt3QkFDOUQsR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDO3dCQUNWLE1BQU0sQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUM7b0JBQ2xCLENBQUM7Z0JBQ0YsQ0FBQztnQkFDRCxXQUFXO2dCQUNYLE1BQU0sQ0FBQyxJQUFJLENBQUM7WUFDYixDQUFDO1FBQ0YsQ0FBQztRQUNELFVBQVUsR0FBRyxHQUFHLEVBQUUsQ0FBQztRQUNuQixNQUFNLENBQUMsVUFBVSxJQUFJLFNBQVMsQ0FBQyxVQUFVLENBQUMsQ0FBQztJQUM1QyxDQUFDO0lBN0JlLGlCQUFTLFlBNkJ4QixDQUFBO0lBRUQ7Ozs7O09BS0c7SUFDSCxnQkFBdUIsT0FBZTtRQUNyQyxNQUFNLENBQUMsT0FBTyxJQUFJLGFBQUssSUFBSSxPQUFPLElBQUkscUJBQWEsQ0FBQztJQUNyRCxDQUFDO0lBRmUsY0FBTSxTQUVyQixDQUFBO0lBRUQ7Ozs7Ozs7Ozs7Ozs7OztPQWVHO0lBQ0gsYUFBb0IsT0FBZSxFQUFFLEtBQThCLEVBQUUsU0FBMEI7UUFBMUIseUJBQTBCLEdBQTFCLGlCQUEwQjtRQUM5RixFQUFFLENBQUMsQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDO1lBQ25DLE1BQU0sQ0FBQyxLQUFLLENBQUM7UUFDZCxDQUFDO1FBRUQsRUFBRSxDQUFDLENBQUMsT0FBTyxLQUFLLEtBQUssVUFBVSxDQUFDLENBQUMsQ0FBQztZQUNqQyxxQkFBYSxDQUFDLE9BQU8sQ0FBQyxHQUFnQixLQUFLLENBQUM7UUFDN0MsQ0FBQztRQUNELElBQUksQ0FBQyxDQUFDO1lBQ0wsYUFBSyxDQUFDLE9BQU8sQ0FBQyxHQUFnQixLQUFLLENBQUM7WUFDcEMsK0ZBQStGO1lBQy9GLE9BQU8scUJBQWEsQ0FBQyxPQUFPLENBQUMsQ0FBQztRQUMvQixDQUFDO1FBQ0QsTUFBTSxDQUFDLElBQUksQ0FBQztJQUNiLENBQUM7SUFkZSxXQUFHLE1BY2xCLENBQUE7SUFFRDs7Ozs7T0FLRztJQUNILGFBQTRCLE9BQWU7UUFDMUMsSUFBSSxNQUFXLENBQUM7UUFFaEIsRUFBRSxDQUFDLENBQUMscUJBQWEsQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDNUIsTUFBTSxHQUFHLGFBQUssQ0FBQyxPQUFPLENBQUMsR0FBRyxxQkFBYSxDQUFDLE9BQU8sQ0FBQyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztZQUM1RCxxQkFBYSxDQUFDLE9BQU8sQ0FBQyxHQUFHLElBQUksQ0FBQztRQUMvQixDQUFDO1FBQ0QsSUFBSSxDQUFDLENBQUM7WUFDTCxNQUFNLEdBQUcsYUFBSyxDQUFDLE9BQU8sQ0FBQyxDQUFDO1FBQ3pCLENBQUM7UUFFRCxNQUFNLENBQUMsTUFBTSxDQUFDO0lBQ2YsQ0FBQztJQVpEO3lCQVlDLENBQUE7SUFFRDs7T0FFRztJQUNILEdBQUcsQ0FBQyxjQUFjLEVBQUUsT0FBTyxRQUFRLEtBQUssV0FBVyxJQUFJLE9BQU8sUUFBUSxLQUFLLFdBQVcsQ0FBQyxDQUFDO0lBQ3hGLEdBQUcsQ0FBQyxXQUFXLEVBQUU7UUFDaEIsRUFBRSxDQUFDLENBQUMsT0FBTyxPQUFPLEtBQUssUUFBUSxJQUFJLE9BQU8sQ0FBQyxRQUFRLElBQUksT0FBTyxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDO1lBQzlFLE1BQU0sQ0FBQyxPQUFPLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQztRQUM5QixDQUFDO0lBQ0YsQ0FBQyxDQUFDLENBQUM7SUFDSCxHQUFHLENBQUMsY0FBYyxFQUFFLGNBQWMsSUFBSSxnQkFBTSxDQUFDLENBQUM7SUFDOUMsR0FBRyxDQUFDLGNBQWMsRUFBRSxPQUFPLGdCQUFNLENBQUMsWUFBWSxLQUFLLFdBQVcsQ0FBQyxDQUFDO0lBQ2hFLEdBQUcsQ0FBQyxzQkFBc0IsRUFBRTtRQUMzQixNQUFNLENBQUMsR0FBRyxDQUFDLGNBQWMsQ0FBQyxJQUFJLE9BQU8sQ0FBQyxnQkFBTSxDQUFDLGdCQUFnQixJQUFJLGdCQUFNLENBQUMsc0JBQXNCLENBQUMsQ0FBQztJQUNqRyxDQUFDLENBQUMsQ0FBQztJQUNILEdBQUcsQ0FBQyxZQUFZLEVBQUU7UUFDakIsTUFBTSxDQUFDLEdBQUcsQ0FBQyxTQUFTLENBQUMsSUFBSSxHQUFHLENBQUMsV0FBVyxDQUFDLElBQUksR0FBRyxDQUFDLHNCQUFzQixDQUFDLENBQUM7SUFDMUUsQ0FBQyxDQUFDLENBQUM7SUFDSCxHQUFHLENBQUMsZUFBZSxFQUFFLE9BQWMsTUFBTyxDQUFDLE1BQU0sS0FBSyxVQUFVLENBQUMsQ0FBQztJQUNsRSxHQUFHLENBQUMsZ0JBQWdCLEVBQUUsT0FBYyxNQUFPLENBQUMsT0FBTyxLQUFLLFVBQVUsQ0FBQyxDQUFDO0lBQ3BFLEdBQUcsQ0FBQyxhQUFhLEVBQUUsT0FBTyxXQUFXLEtBQUssVUFBVSxDQUFDLENBQUM7SUFDdEQsR0FBRyxDQUFDLFNBQVMsRUFBRSxPQUFPLGdCQUFNLENBQUMsT0FBTyxLQUFLLFdBQVcsQ0FBQyxDQUFDO0lBQ3RELEdBQUcsQ0FBQyxLQUFLLEVBQUUsT0FBTyxxQkFBcUIsS0FBSyxVQUFVLENBQUMsQ0FBQztJQUN4RCxHQUFHLENBQUMsU0FBUyxFQUFFO1FBQ2QsRUFBRSxDQUFDLENBQUMsT0FBTyxnQkFBTSxDQUFDLE9BQU8sS0FBSyxXQUFXLENBQUMsQ0FBQyxDQUFDO1lBQzNDLElBQU0sSUFBSSxHQUFHLEVBQUUsQ0FBQztZQUNoQixJQUFNLElBQUksR0FBRyxFQUFFLENBQUM7WUFDaEIsSUFBTSxHQUFHLEdBQUcsSUFBSSxnQkFBTSxDQUFDLE9BQU8sQ0FBQyxDQUFFLENBQUUsSUFBSSxFQUFFLENBQUMsQ0FBRSxDQUFFLENBQUMsQ0FBQztZQUNoRCxNQUFNLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLElBQUksR0FBRyxDQUFDLEdBQUcsQ0FBQyxJQUFJLEVBQUUsQ0FBQyxDQUFDLEtBQUssR0FBRyxDQUFDO1FBQ3hELENBQUM7UUFDRCxNQUFNLENBQUMsS0FBSyxDQUFDO0lBQ2QsQ0FBQyxDQUFDLENBQUM7SUFDSCxHQUFHLENBQUMsYUFBYSxFQUFFLE9BQU8sZ0JBQU0sQ0FBQyxXQUFXLEtBQUssV0FBVyxDQUFDLENBQUM7SUFDOUQsR0FBRyxDQUFDLFVBQVUsRUFBRSxPQUFPLGdCQUFNLENBQUMsUUFBUSxLQUFLLFdBQVcsQ0FBQyxDQUFDO0lBQ3hELEdBQUcsQ0FBQyxLQUFLLEVBQUUsT0FBTyxnQkFBTSxDQUFDLGNBQWMsS0FBSyxXQUFXLENBQUMsQ0FBQztJQUN6RCxHQUFHLENBQUMsTUFBTSxFQUFFLEdBQUcsQ0FBQyxLQUFLLENBQUMsSUFBSSxjQUFjLElBQUksZ0JBQU0sQ0FBQyxjQUFjLENBQUMsU0FBUyxDQUFDLENBQUM7SUFDN0UsR0FBRyxDQUFDLFdBQVcsRUFBRTtRQUNoQixFQUFFLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDbEIsTUFBTSxDQUFDLEtBQUssQ0FBQztRQUNkLENBQUM7UUFFRCxJQUFNLE9BQU8sR0FBRyxJQUFJLGNBQWMsRUFBRSxDQUFDO1FBQ3JDLE9BQU8sQ0FBQyxJQUFJLENBQUMsS0FBSyxFQUFFLEdBQUcsRUFBRSxJQUFJLENBQUMsQ0FBQztRQUMvQixPQUFPLENBQUMsWUFBWSxHQUFHLE1BQU0sQ0FBQztRQUM5QixPQUFPLENBQUMsS0FBSyxFQUFFLENBQUM7UUFDaEIsTUFBTSxDQUFDLE9BQU8sQ0FBQyxZQUFZLEtBQUssTUFBTSxDQUFDO0lBQ3hDLENBQUMsQ0FBQyxDQUFDO0lBQ0gsR0FBRyxDQUFDLFlBQVksRUFBRSxPQUFPLGdCQUFNLENBQUMsTUFBTSxLQUFLLFVBQVUsQ0FBQyxDQUFDO0lBQ3ZELEdBQUcsQ0FBQyxTQUFTLEVBQUU7UUFDZCxFQUFFLENBQUMsQ0FBQyxPQUFPLGdCQUFNLENBQUMsR0FBRyxLQUFLLFVBQVUsQ0FBQyxDQUFDLENBQUM7WUFDdEMsa0ZBQWtGO1lBQ2xGLElBQU0sR0FBRyxHQUFHLElBQUksZ0JBQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQ2hDLE1BQU0sQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxJQUFJLE1BQU0sSUFBSSxHQUFHLElBQUksT0FBTyxHQUFHLENBQUMsSUFBSSxLQUFLLFVBQVUsQ0FBQztRQUN0RSxDQUFDO1FBQ0QsTUFBTSxDQUFDLEtBQUssQ0FBQztJQUNkLENBQUMsQ0FBQyxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IGdsb2JhbCBmcm9tICcuL2dsb2JhbCc7XG5pbXBvcnQgeyBIYXNoIH0gZnJvbSAnLi9pbnRlcmZhY2VzJztcblxuZXhwb3J0IHR5cGUgVGVzdFJlc3VsdCA9IGJvb2xlYW4gfCBzdHJpbmcgfCBudW1iZXI7XG5leHBvcnQgdHlwZSBUZXN0TWV0aG9kID0gKCkgPT4gVGVzdFJlc3VsdDtcblxuZXhwb3J0IGNvbnN0IGNhY2hlOiBIYXNoPFRlc3RSZXN1bHQ+ID0gT2JqZWN0LmNyZWF0ZShudWxsKTtcbmV4cG9ydCBjb25zdCB0ZXN0RnVuY3Rpb25zOiBIYXNoPFRlc3RNZXRob2Q+ID0gT2JqZWN0LmNyZWF0ZShudWxsKTtcblxuLyoqXG4gKiBDb25kaXRpb25hbCBsb2FkaW5nIG9mIEFNRCBtb2R1bGVzIGJhc2VkIG9uIGEgaGFzIGZlYXR1cmUgdGVzdCB2YWx1ZS5cbiAqXG4gKiBAcGFyYW0gcmVzb3VyY2VJZCBHaXZlcyB0aGUgcmVzb2x2ZWQgbW9kdWxlIGlkIHRvIGxvYWQuXG4gKiBAcGFyYW0gcmVxdWlyZSBUaGUgbG9hZGVyIHJlcXVpcmUgZnVuY3Rpb24gd2l0aCByZXNwZWN0IHRvIHRoZSBtb2R1bGUgdGhhdCBjb250YWluZWQgdGhlIHBsdWdpbiByZXNvdXJjZSBpbiBpdCdzIGRlcGVuZGVuY3kgbGlzdC5cbiAqIEBwYXJhbSBsb2FkIENhbGxiYWNrIHRvIGxvYWRlciB0aGF0IGNvbnN1bWVzIHJlc3VsdCBvZiBwbHVnaW4gZGVtYW5kLlxuICovXG5leHBvcnQgZnVuY3Rpb24gbG9hZChyZXNvdXJjZUlkOiBzdHJpbmcsIHJlcXVpcmU6IERvam9Mb2FkZXIuUmVxdWlyZSwgbG9hZDogKHZhbHVlPzogYW55KSA9PiB2b2lkLCBjb25maWc/OiBEb2pvTG9hZGVyLkNvbmZpZyk6IHZvaWQge1xuXHRpZiAocmVzb3VyY2VJZCkge1xuXHRcdHJlcXVpcmUoWyByZXNvdXJjZUlkIF0sIGxvYWQpO1xuXHR9XG5cdGVsc2Uge1xuXHRcdGxvYWQoKTtcblx0fVxufVxuXG4vKipcbiAqIFJlc29sdmVzIHJlc291cmNlSWQgaW50byBhIG1vZHVsZSBpZCBiYXNlZCBvbiBwb3NzaWJseS1uZXN0ZWQgdGVuYXJ5IGV4cHJlc3Npb24gdGhhdCBicmFuY2hlcyBvbiBoYXMgZmVhdHVyZSB0ZXN0IHZhbHVlKHMpLlxuICpcbiAqIEBwYXJhbSByZXNvdXJjZUlkIFRoZSBpZCBvZiB0aGUgbW9kdWxlXG4gKiBAcGFyYW0gbm9ybWFsaXplIFJlc29sdmVzIGEgcmVsYXRpdmUgbW9kdWxlIGlkIGludG8gYW4gYWJzb2x1dGUgbW9kdWxlIGlkXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBub3JtYWxpemUocmVzb3VyY2VJZDogc3RyaW5nLCBub3JtYWxpemU6IChtb2R1bGVJZDogc3RyaW5nKSA9PiBzdHJpbmcpOiBzdHJpbmcge1xuXHRjb25zdCB0b2tlbnMgPSByZXNvdXJjZUlkLm1hdGNoKC9bXFw/Ol18W146XFw/XSovZyk7XG5cdGxldCBpID0gMDtcblxuXHRmdW5jdGlvbiBnZXQoc2tpcD86IGJvb2xlYW4pOiBzdHJpbmcge1xuXHRcdGNvbnN0IHRlcm0gPSB0b2tlbnNbaSsrXTtcblx0XHRpZiAodGVybSA9PT0gJzonKSB7XG5cdFx0XHQvLyBlbXB0eSBzdHJpbmcgbW9kdWxlIG5hbWUsIHJlc29sdmVzIHRvIG51bGxcblx0XHRcdHJldHVybiBudWxsO1xuXHRcdH1cblx0XHRlbHNlIHtcblx0XHRcdC8vIHBvc3RmaXhlZCB3aXRoIGEgPyBtZWFucyBpdCBpcyBhIGZlYXR1cmUgdG8gYnJhbmNoIG9uLCB0aGUgdGVybSBpcyB0aGUgbmFtZSBvZiB0aGUgZmVhdHVyZVxuXHRcdFx0aWYgKHRva2Vuc1tpKytdID09PSAnPycpIHtcblx0XHRcdFx0aWYgKCFza2lwICYmIGhhcyh0ZXJtKSkge1xuXHRcdFx0XHRcdC8vIG1hdGNoZWQgdGhlIGZlYXR1cmUsIGdldCB0aGUgZmlyc3QgdmFsdWUgZnJvbSB0aGUgb3B0aW9uc1xuXHRcdFx0XHRcdHJldHVybiBnZXQoKTtcblx0XHRcdFx0fVxuXHRcdFx0XHRlbHNlIHtcblx0XHRcdFx0XHQvLyBkaWQgbm90IG1hdGNoLCBnZXQgdGhlIHNlY29uZCB2YWx1ZSwgcGFzc2luZyBvdmVyIHRoZSBmaXJzdFxuXHRcdFx0XHRcdGdldCh0cnVlKTtcblx0XHRcdFx0XHRyZXR1cm4gZ2V0KHNraXApO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0XHQvLyBhIG1vZHVsZVxuXHRcdFx0cmV0dXJuIHRlcm07XG5cdFx0fVxuXHR9XG5cdHJlc291cmNlSWQgPSBnZXQoKTtcblx0cmV0dXJuIHJlc291cmNlSWQgJiYgbm9ybWFsaXplKHJlc291cmNlSWQpO1xufVxuXG4vKipcbiAqIENoZWNrIGlmIGEgZmVhdHVyZSBoYXMgYWxyZWFkeSBiZWVuIHJlZ2lzdGVyZWRcbiAqXG4gKiBAcGFyYW0gZmVhdHVyZSB0aGUgbmFtZSBvZiB0aGUgZmVhdHVyZVxuICogQHJldHVybiBpZiB0aGUgZmVhdHVyZSBoYXMgYmVlbiByZWdpc3RlcmVkXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBleGlzdHMoZmVhdHVyZTogc3RyaW5nKTogYm9vbGVhbiB7XG5cdHJldHVybiBmZWF0dXJlIGluIGNhY2hlIHx8IGZlYXR1cmUgaW4gdGVzdEZ1bmN0aW9ucztcbn1cblxuLyoqXG4gKiBSZWdpc3RlciBhIG5ldyB0ZXN0IGZvciBhIG5hbWVkIGZlYXR1cmUuXG4gKlxuICogQGV4YW1wbGVcbiAqIGhhcy5hZGQoJ2RvbS1hZGRldmVudGxpc3RlbmVyJywgISFkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKTtcbiAqXG4gKiBAZXhhbXBsZVxuICogaGFzLmFkZCgndG91Y2gtZXZlbnRzJywgZnVuY3Rpb24gKCkge1xuICogICAgcmV0dXJuICdvbnRvdWNoc3RhcnQnIGluIGRvY3VtZW50XG4gKiB9KTtcbiAqXG4gKiBAcGFyYW0gZmVhdHVyZSB0aGUgbmFtZSBvZiB0aGUgZmVhdHVyZVxuICogQHBhcmFtIHZhbHVlIHRoZSB2YWx1ZSByZXBvcnRlZCBvZiB0aGUgZmVhdHVyZSwgb3IgYSBmdW5jdGlvbiB0aGF0IHdpbGwgYmUgZXhlY3V0ZWQgb25jZSBvbiBmaXJzdCB0ZXN0XG4gKiBAcGFyYW0gb3ZlcndyaXRlIGlmIGFuIGV4aXN0aW5nIHZhbHVlIHNob3VsZCBiZSBvdmVyd3JpdHRlbi4gRGVmYXVsdHMgdG8gZmFsc2UuXG4gKiBAcmV0dXJuIGlmIHRoZSBmZWF0dXJlIHRlc3Qgd2FzIHN1Y2Nlc3NmdWxseSBhZGRlZFxuICovXG5leHBvcnQgZnVuY3Rpb24gYWRkKGZlYXR1cmU6IHN0cmluZywgdmFsdWU6IFRlc3RSZXN1bHQgfCBUZXN0TWV0aG9kLCBvdmVyd3JpdGU6IGJvb2xlYW4gPSBmYWxzZSk6IGJvb2xlYW4ge1xuXHRpZiAoZXhpc3RzKGZlYXR1cmUpICYmICFvdmVyd3JpdGUpIHtcblx0XHRyZXR1cm4gZmFsc2U7XG5cdH1cblxuXHRpZiAodHlwZW9mIHZhbHVlID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0dGVzdEZ1bmN0aW9uc1tmZWF0dXJlXSA9IDxUZXN0TWV0aG9kPiB2YWx1ZTtcblx0fVxuXHRlbHNlIHtcblx0XHRjYWNoZVtmZWF0dXJlXSA9IDxUZXN0UmVzdWx0PiB2YWx1ZTtcblx0XHQvLyBFbnN1cmUgd2UgZG9uJ3QgaGF2ZSBzdGFsZSB0ZXN0cyBzaXR0aW5nIGFyb3VuZCB0aGF0IGNvdWxkIG92ZXJ3cml0ZSBhIGNhY2hlIHZhbHVlIGJlaW5nIHNldFxuXHRcdGRlbGV0ZSB0ZXN0RnVuY3Rpb25zW2ZlYXR1cmVdO1xuXHR9XG5cdHJldHVybiB0cnVlO1xufVxuXG4vKipcbiAqIFJldHVybiB0aGUgY3VycmVudCB2YWx1ZSBvZiBhIG5hbWVkIGZlYXR1cmUuXG4gKlxuICogQHBhcmFtIGZlYXR1cmUgVGhlIG5hbWUgKGlmIGEgc3RyaW5nKSBvciBpZGVudGlmaWVyIChpZiBhbiBpbnRlZ2VyKSBvZiB0aGUgZmVhdHVyZSB0byB0ZXN0LlxuICogQHJldHVybiBUaGUgdmFsdWUgb2YgYSBnaXZlbiBmZWF0dXJlIHRlc3RcbiAqL1xuZXhwb3J0IGRlZmF1bHQgZnVuY3Rpb24gaGFzKGZlYXR1cmU6IHN0cmluZyk6IFRlc3RSZXN1bHQge1xuXHRsZXQgcmVzdWx0OiBhbnk7XG5cblx0aWYgKHRlc3RGdW5jdGlvbnNbZmVhdHVyZV0pIHtcblx0XHRyZXN1bHQgPSBjYWNoZVtmZWF0dXJlXSA9IHRlc3RGdW5jdGlvbnNbZmVhdHVyZV0uY2FsbChudWxsKTtcblx0XHR0ZXN0RnVuY3Rpb25zW2ZlYXR1cmVdID0gbnVsbDtcblx0fVxuXHRlbHNlIHtcblx0XHRyZXN1bHQgPSBjYWNoZVtmZWF0dXJlXTtcblx0fVxuXG5cdHJldHVybiByZXN1bHQ7XG59XG5cbi8qXG4gKiBPT1RCIGZlYXR1cmUgdGVzdHNcbiAqL1xuYWRkKCdob3N0LWJyb3dzZXInLCB0eXBlb2YgZG9jdW1lbnQgIT09ICd1bmRlZmluZWQnICYmIHR5cGVvZiBsb2NhdGlvbiAhPT0gJ3VuZGVmaW5lZCcpO1xuYWRkKCdob3N0LW5vZGUnLCBmdW5jdGlvbiAoKSB7XG5cdGlmICh0eXBlb2YgcHJvY2VzcyA9PT0gJ29iamVjdCcgJiYgcHJvY2Vzcy52ZXJzaW9ucyAmJiBwcm9jZXNzLnZlcnNpb25zLm5vZGUpIHtcblx0XHRyZXR1cm4gcHJvY2Vzcy52ZXJzaW9ucy5ub2RlO1xuXHR9XG59KTtcbmFkZCgnZmxvYXQzMmFycmF5JywgJ0Zsb2F0MzJBcnJheScgaW4gZ2xvYmFsKTtcbmFkZCgnc2V0aW1tZWRpYXRlJywgdHlwZW9mIGdsb2JhbC5zZXRJbW1lZGlhdGUgIT09ICd1bmRlZmluZWQnKTtcbmFkZCgnZG9tLW11dGF0aW9ub2JzZXJ2ZXInLCBmdW5jdGlvbigpOiBib29sZWFuIHtcblx0cmV0dXJuIGhhcygnaG9zdC1icm93c2VyJykgJiYgQm9vbGVhbihnbG9iYWwuTXV0YXRpb25PYnNlcnZlciB8fCBnbG9iYWwuV2ViS2l0TXV0YXRpb25PYnNlcnZlcik7XG59KTtcbmFkZCgnbWljcm90YXNrcycsIGZ1bmN0aW9uICgpIHtcblx0cmV0dXJuIGhhcygncHJvbWlzZScpIHx8IGhhcygnaG9zdC1ub2RlJykgfHwgaGFzKCdkb20tbXV0YXRpb25vYnNlcnZlcicpO1xufSk7XG5hZGQoJ29iamVjdC1hc3NpZ24nLCB0eXBlb2YgKDxhbnk+IE9iamVjdCkuYXNzaWduID09PSAnZnVuY3Rpb24nKTtcbmFkZCgnb2JqZWN0LW9ic2VydmUnLCB0eXBlb2YgKDxhbnk+IE9iamVjdCkub2JzZXJ2ZSA9PT0gJ2Z1bmN0aW9uJyk7XG5hZGQoJ3Bvc3RtZXNzYWdlJywgdHlwZW9mIHBvc3RNZXNzYWdlID09PSAnZnVuY3Rpb24nKTtcbmFkZCgncHJvbWlzZScsIHR5cGVvZiBnbG9iYWwuUHJvbWlzZSAhPT0gJ3VuZGVmaW5lZCcpO1xuYWRkKCdyYWYnLCB0eXBlb2YgcmVxdWVzdEFuaW1hdGlvbkZyYW1lID09PSAnZnVuY3Rpb24nKTtcbmFkZCgnd2Vha21hcCcsIGZ1bmN0aW9uICgpIHtcblx0aWYgKHR5cGVvZiBnbG9iYWwuV2Vha01hcCAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRjb25zdCBrZXkxID0ge307XG5cdFx0Y29uc3Qga2V5MiA9IHt9O1xuXHRcdGNvbnN0IG1hcCA9IG5ldyBnbG9iYWwuV2Vha01hcChbIFsga2V5MSwgMSBdIF0pO1xuXHRcdHJldHVybiBtYXAuZ2V0KGtleTEpID09PSAxICYmIG1hcC5zZXQoa2V5MiwgMikgPT09IG1hcDtcblx0fVxuXHRyZXR1cm4gZmFsc2U7XG59KTtcbmFkZCgnYXJyYXlidWZmZXInLCB0eXBlb2YgZ2xvYmFsLkFycmF5QnVmZmVyICE9PSAndW5kZWZpbmVkJyk7XG5hZGQoJ2Zvcm1kYXRhJywgdHlwZW9mIGdsb2JhbC5Gb3JtRGF0YSAhPT0gJ3VuZGVmaW5lZCcpO1xuYWRkKCd4aHInLCB0eXBlb2YgZ2xvYmFsLlhNTEh0dHBSZXF1ZXN0ICE9PSAndW5kZWZpbmVkJyk7XG5hZGQoJ3hocjInLCBoYXMoJ3hocicpICYmICdyZXNwb25zZVR5cGUnIGluIGdsb2JhbC5YTUxIdHRwUmVxdWVzdC5wcm90b3R5cGUpO1xuYWRkKCd4aHIyLWJsb2InLCBmdW5jdGlvbiAoKSB7XG5cdGlmICghaGFzKCd4aHIyJykpIHtcblx0XHRyZXR1cm4gZmFsc2U7XG5cdH1cblxuXHRjb25zdCByZXF1ZXN0ID0gbmV3IFhNTEh0dHBSZXF1ZXN0KCk7XG5cdHJlcXVlc3Qub3BlbignR0VUJywgJy8nLCB0cnVlKTtcblx0cmVxdWVzdC5yZXNwb25zZVR5cGUgPSAnYmxvYic7XG5cdHJlcXVlc3QuYWJvcnQoKTtcblx0cmV0dXJuIHJlcXVlc3QucmVzcG9uc2VUeXBlID09PSAnYmxvYic7XG59KTtcbmFkZCgnZXM2LXN5bWJvbCcsIHR5cGVvZiBnbG9iYWwuU3ltYm9sID09PSAnZnVuY3Rpb24nKTtcbmFkZCgnZXM2LXNldCcsICgpID0+IHtcblx0aWYgKHR5cGVvZiBnbG9iYWwuU2V0ID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0LyogSUUxMSBhbmQgb2xkZXIgdmVyc2lvbnMgb2YgU2FmYXJpIGFyZSBtaXNzaW5nIGNyaXRpY2FsIEVTNiBTZXQgZnVuY3Rpb25hbGl0eSAqL1xuXHRcdGNvbnN0IHNldCA9IG5ldyBnbG9iYWwuU2V0KFsxXSk7XG5cdFx0cmV0dXJuIHNldC5oYXMoMSkgJiYgJ2tleXMnIGluIHNldCAmJiB0eXBlb2Ygc2V0LmtleXMgPT09ICdmdW5jdGlvbic7XG5cdH1cblx0cmV0dXJuIGZhbHNlO1xufSk7XG4iXX0=